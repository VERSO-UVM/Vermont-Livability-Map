import{r as u,b as U,c as r,o as c,d as a,t as z,n as K,w as Z,e as ee,f as j,g as te,h as oe,v as ne,F as x,i as C,j as q,m as h,k as ae}from"./index-CtNTE5jI.js";const ie={class:"bar-chart-container"},le={class:"bar-wrapper"},se={class:"percentage-label"},re={__name:"ProgressBar",props:{percentage:{type:Number,required:!0,validator:p=>p>=0&&p<=100},title:{type:String,required:!0}},setup(p){const v=p,g=u(0);return U(()=>{setTimeout(()=>{g.value=v.percentage},100)}),(L,d)=>(c(),r("div",ie,[a("h3",null,z(p.title),1),a("div",le,[a("div",{class:"bar",style:K({width:p.percentage+"%"})},[a("span",se,z(p.percentage)+"%",1)],4)])]))}},ce={class:"map-container"},de={class:"controls"},ue={key:0,class:"suggestions"},ge=["onClick"],pe={key:0,class:"zoning-type-breakdown"},fe={key:1,class:"data-summary"},ye={__name:"RegionalMapHighlight",props:{mapboxToken:{type:String,required:!0},initialCenter:{type:Array,default:()=>[-72.5778,44.4688]},initialZoom:{type:Number,default:6},layerToHighlight:{type:String,default:"Nonresidential",requred:!1}},setup(p){const v=p,g=u([]);u(!1);const L=u([]);u("");const d=u(""),T=u([]),w=u([]),N=u(["Full_District_Name","Affordable_Housing_District","Type_of_Zoning_District"]),$=u([]),M=u(0),B=u([]);Z(w,n=>{if(!n.length){B.value=[];return}const o=n.length,e={};n.forEach(l=>{const s=l.properties.Type_of_Zoning_District||"Unknown";e[s]=(e[s]||0)+1}),B.value=Object.entries(e).map(([l,s])=>({type:l,percentage:(s/o*100).toFixed(2)}))});let E=null;const A=()=>{const n=d.value.toLowerCase();T.value=L.value.filter(o=>o.toLowerCase().includes(n))},V=n=>{d.value=n,T.value=[]},I=()=>{if(!t){console.error("Map instance is not initialized.");return}if(d.value){console.log(`Applying filter for jurisdiction: ${d.value}`),t.setFilter("fgb-layer",["==",["get","Jurisdiction"],d.value]),w.value=g.value.filter(e=>e.properties.Jurisdiction===d.value),$.value=w.value.map(e=>{const l={};return N.value.forEach(s=>{l[s]=e.properties[s]||"N/A"}),l}),M.value=new Set(w.value.map(e=>e.properties.Jurisdiction)).size;const n=new h.LngLatBounds;let o=0;if(g.value.forEach(e=>{if(e.properties.Jurisdiction===d.value&&e.geometry){o++;const l=e.geometry.coordinates;e.geometry.type==="Polygon"?l[0].forEach(s=>n.extend(s)):e.geometry.type==="Point"&&n.extend(l)}}),o===0?console.warn(`No features found for jurisdiction: ${d.value}`):console.log(`Found ${o} features for jurisdiction: ${d.value}`),!n.isEmpty())console.log("Fitting map to bounds:",n),t.fitBounds(n,{padding:50}),E=n;else if(console.warn("Bounds are empty. Unable to fit map."),g.value.length>0){console.log("Using default bounds as fallback.");const e=new h.LngLatBounds([-73.5,42.5],[-71.5,45]);t.fitBounds(e,{padding:50})}else if(E)console.log("Using last valid bounds as fallback:",E),t.fitBounds(E,{padding:50});else{console.warn("No fallback bounds available. Using default bounds.");const e=new h.LngLatBounds([-73.5,42.5],[-71.5,45]);t.fitBounds(e,{padding:50})}}else console.log("No jurisdiction selected. Resetting filter."),t.setFilter("fgb-layer",null),w.value=[],$.value=[],M.value=0};Z(v,n=>{console.log("props changed",n.layerToHighlight),n.layerToHighlight==2?J("Primarily Residential"):n.layerToHighlight==3?J("Nonresidential"):R()},{deep:!1});const J=n=>{console.log("toggle",t),t&&(t.setPaintProperty("fgb-layer","fill-opacity",0),setTimeout(()=>{t.setFilter("fgb-layer",["==",["get","Type_of_Zoning_District"],n]),t.setPaintProperty("fgb-layer","fill-opacity",.9)},300))},R=()=>{t.setPaintProperty("fgb-layer","fill-opacity",0),setTimeout(()=>{t.setFilter("fgb-layer",null),t.setPaintProperty("fgb-layer","fill-opacity",.9)},100)};let t;const G=()=>{t=new h.Map({accessToken:v.mapboxToken,container:"zoning-map",style:"mapbox://styles/mapbox/light-v11",center:v.initialCenter,zoom:v.initialZoom});const n=document.getElementById("zoning-map-loading"),o=document.getElementById("zoning-map-progress"),e=document.getElementById("zoning-map-legend");let l=0,s=null;const D=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3","#7fc97f","#beaed4","#fdc086"],b=new Map;let H=0;function O(i){return b.has(i)||(b.set(i,D[H%D.length]),H++,W()),b.get(i)}function W(){const i=document.createElement("div");for(Array.from(b.entries()).sort((k,y)=>k[0].localeCompare(y[0])).forEach(([k,y])=>{const m=document.createElement("div");m.className="legend-item",m.innerHTML=`<div class="color-block" style="background-color: ${y}"></div>${k}`,i.appendChild(m)});e.childNodes.length>2;)e.removeChild(e.lastChild);e.appendChild(i)}function X(i){l=i,o.textContent=`Loaded ${i} features`}t.on("load",async()=>{try{n.style.display="block",o.style.display="block",console.log("Starting to load FlatGeoBuf data..."),t.addSource("fgb-data",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"fgb-layer",type:"fill",source:"fgb-data",paint:{"fill-color":"#ccc","fill-opacity":.7,"fill-outline-color":"#000"}}),s=t.getSource("fgb-data");let i=[];const y=await fetch("https://verso-uvm.github.io/Vermont-Livability-Map/data/vt-zoning-spatial-index.fgb");if(!y.ok)throw new Error(`HTTP error! status: ${y.status}`);const m=new Set;for await(const f of ae(y.body)){const F=f.properties.Type_of_Zoning_District||"Unknown";O(F);const S=f.properties.Jurisdiction||"Unknown";if(m.add(S),i.push(f),l++,l%100===0&&(X(l),s.setData({type:"FeatureCollection",features:i}),b.size>0)){const P=["match",["get","Type_of_Zoning_District"]];for(const[Y,Q]of b)P.push(Y),P.push(Q);P.push("#ccc"),t.setPaintProperty("fgb-layer","fill-color",P)}}L.value=Array.from(m).sort(),T.value=L.value,s.setData({type:"FeatureCollection",features:i}),g.value=i,console.log(i);const _=new h.LngLatBounds;i.forEach(f=>{if(f.geometry){const F=f.geometry.coordinates;f.geometry.type==="Polygon"?F[0].forEach(S=>_.extend(S)):f.geometry.type==="Point"&&_.extend(F)}}),t.fitBounds(_,{padding:50}),console.log("Map visualization complete"),console.log("Zoning types and colors:",Array.from(b.entries()))}catch(i){console.error("Error loading FlatGeoBuf data:",i),n.textContent="Error loading data"}finally{n.style.display="none",o.style.display="none"}}),t.on("click","fgb-layer",i=>{if(!i.features.length)return;const k=i.features[0],y=i.lngLat,m=Object.entries(k.properties).map(([_,f])=>`<strong>${_}:</strong> ${f}`).join("<br>");new h.Popup().setLngLat(y).setHTML(m).addTo(t)}),t.on("mouseenter","fgb-layer",()=>{t.getCanvas().style.cursor="pointer"}),t.on("mouseleave","fgb-layer",()=>{t.getCanvas().style.cursor=""}),t.addControl(new h.NavigationControl)};return U(()=>{G()}),ee(()=>{t.value&&t.value.remove()}),(n,o)=>(c(),r("div",null,[a("div",ce,[o[2]||(o[2]=a("div",{class:"disclaimer"},[a("span",{class:"exclamation-icon"},"!"),te(" This map is in Beta, and may contain inaccuracies. ")],-1)),a("div",de,[o[1]||(o[1]=a("label",{style:{"margin-right":"10px"},for:"jurisdiction-search"},"Search for a Town:",-1)),oe(a("input",{id:"jurisdiction-search",type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>d.value=e),onInput:A,placeholder:"Type to search..."},null,544),[[ne,d.value]]),T.value.length?(c(),r("ul",ue,[(c(!0),r(x,null,C(T.value,e=>(c(),r("li",{key:e,onClick:l=>V(e)},z(e),9,ge))),128))])):j("",!0),a("button",{onClick:I,class:"search-button"},"Search")]),o[3]||(o[3]=a("div",{id:"zoning-map"},null,-1)),o[4]||(o[4]=a("div",{id:"zoning-map-loading",class:"loading"},"Loading data...",-1)),o[5]||(o[5]=a("div",{id:"zoning-map-progress"},null,-1)),o[6]||(o[6]=a("div",{id:"zoning-map-legend",class:"legend"},[a("h4",null,"Primary zoning classification")],-1))]),B.value.length?(c(),r("div",pe,[o[7]||(o[7]=a("h3",{style:{"text-align":"center","font-weight":"600"}},"% of districts per zoning type",-1)),(c(!0),r(x,null,C(B.value,(e,l)=>(c(),r("div",{key:l},[q(re,{title:e.type,percentage:e.percentage},null,8,["title","percentage"])]))),128))])):j("",!0),w.value.length?(c(),r("div",fe,[o[8]||(o[8]=a("h4",null,"Town Summary",-1)),a("table",null,[a("thead",null,[a("tr",null,[(c(!0),r(x,null,C(N.value,e=>(c(),r("th",{key:e},z(e),1))),128))])]),a("tbody",null,[(c(!0),r(x,null,C($.value,(e,l)=>(c(),r("tr",{key:l},[(c(!0),r(x,null,C(N.value,s=>(c(),r("td",{key:s},z(e[s]),1))),128))]))),128))])])])):j("",!0)]))}},me={class:"about"},ve={class:"about-container"},he={__name:"RegionalView",setup(p){return(v,g)=>(c(),r("div",me,[a("div",ve,[g[0]||(g[0]=a("h1",{class:"title",style:{"margin-top":"50px"}},"Select a Town",-1)),g[1]||(g[1]=a("p",null," This interactive interface allows you to explore the zoning regulations of different towns in the region. Type in a town and click Search to view its zoning regulations. ",-1)),q(ye,{mapboxToken:"pk.eyJ1IjoiYmRjb29sZXkiLCJhIjoiY20zM2Nzd212MWl3cTJrcTM5NWNrcjk0byJ9.40rHMMd1TXsvF8zeqxLaBw"})])]))}};export{he as default};
