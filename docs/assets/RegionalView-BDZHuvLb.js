import{r as g,b as A,c as r,o as c,d as s,t as E,n as K,w as Z,e as ee,f as J,g as te,h as oe,v as ne,F as L,i as B,j as V,m as h,k as le}from"./index-BPrh9KVG.js";const se={class:"bar-chart-container"},ae={class:"bar-wrapper"},ie={class:"percentage-label"},re={__name:"ProgressBar",props:{percentage:{type:String,required:!0,validator:m=>{const p=Number(m);return!isNaN(p)&&p>=0&&p<=100}},title:{type:String,required:!0}},setup(m){const p=m,d=g(0);return A(()=>{setTimeout(()=>{d.value=p.percentage},100)}),(P,u)=>(c(),r("div",se,[s("h3",null,E(m.title),1),s("div",ae,[s("div",{class:"bar",style:K({width:m.percentage+"%"})},[s("span",ie,E(m.percentage)+"%",1)],4)])]))}},ce={class:"map-container"},de={class:"controls"},ue={key:0,class:"suggestions"},ge=["onClick"],pe={key:0,class:"zoning-type-breakdown"},fe={key:1,class:"data-summary"},ye={__name:"RegionalMapHighlight",props:{mapboxToken:{type:String,required:!0},initialCenter:{type:Array,default:()=>[-72.5778,44.4688]},initialZoom:{type:Number,default:6},layerToHighlight:{type:String,default:"Nonresidential",requred:!1}},setup(m){const p=m,d=g([]);g(!1);const P=g([]);g("");const u=g(""),T=g([]),w=g([]),S=g(["Full_District_Name","Affordable_Housing_District","Type_of_Zoning_District"]),$=g([]),D=g(0),z=g([]);Z(w,l=>{if(!l.length){z.value=[];return}const o=l.length,e={};l.forEach(n=>{const i=n.properties.Type_of_Zoning_District||"Unknown";e[i]=(e[i]||0)+1}),z.value=Object.entries(e).map(([n,i])=>({type:n,percentage:(i/o*100).toFixed(2)}))});let x=null;const q=()=>{const l=u.value.toLowerCase();T.value=P.value.filter(o=>o.toLowerCase().includes(l))},U=l=>{u.value=l,T.value=[]},I=()=>{if(!t){console.error("Map instance is not initialized.");return}if(u.value){console.log(`Applying filter for jurisdiction: ${u.value}`),t.setFilter("fgb-layer",["==",["get","Jurisdiction"],u.value]),w.value=d.value.filter(e=>e.properties.Jurisdiction===u.value),$.value=w.value.map(e=>{const n={};return S.value.forEach(i=>{n[i]=e.properties[i]||"N/A"}),n}),D.value=new Set(w.value.map(e=>e.properties.Jurisdiction)).size;const l=new h.LngLatBounds;let o=0;if(d.value.forEach(e=>{if(e.properties.Jurisdiction.toLowerCase()===u.value.toLowerCase()&&e.geometry){o++;const n=e.geometry.coordinates;e.geometry.type==="Polygon"||e.geometry.type==="MultiPolygon"?(e.geometry.type==="Polygon"?[n]:n).forEach(_=>{_[0].forEach(f=>l.extend(f))}):e.geometry.type==="Point"&&l.extend(n)}}),o===0?console.warn(`No features found for jurisdiction: ${u.value}`):console.log(`Found ${o} features for jurisdiction: ${u.value}`),!l.isEmpty())console.log("Fitting map to bounds:",l),t.fitBounds(l,{padding:50}),x=l;else if(console.warn("Bounds are empty. Attempting to use fallback bounds."),x)console.log("Using last valid bounds as fallback:",x),t.fitBounds(x,{padding:50});else if(d.value.length>0){console.log("Calculating fallback bounds from all features.");const e=new h.LngLatBounds;if(d.value.forEach(n=>{if(n.geometry){const i=n.geometry.coordinates;n.geometry.type==="Polygon"||n.geometry.type==="MultiPolygon"?(n.geometry.type==="Polygon"?[i]:i).forEach(f=>{f[0].forEach(F=>e.extend(F))}):n.geometry.type==="Point"&&e.extend(i)}}),!e.isEmpty())t.fitBounds(e,{padding:50}),x=e;else{console.warn("Fallback bounds are also empty. Using default bounds.");const n=new h.LngLatBounds([-73.5,42.5],[-71.5,45]);t.fitBounds(n,{padding:50})}}else{console.warn("No fallback bounds available. Using default bounds.");const e=new h.LngLatBounds([-73.5,42.5],[-71.5,45]);t.fitBounds(e,{padding:50})}}else console.log("No jurisdiction selected. Resetting filter."),t.setFilter("fgb-layer",null),w.value=[],$.value=[],D.value=0};Z(p,l=>{console.log("props changed",l.layerToHighlight),l.layerToHighlight==2?H("Primarily Residential"):l.layerToHighlight==3?H("Nonresidential"):R()},{deep:!1});const H=l=>{console.log("toggle",t),t&&(t.setPaintProperty("fgb-layer","fill-opacity",0),setTimeout(()=>{t.setFilter("fgb-layer",["==",["get","Type_of_Zoning_District"],l]),t.setPaintProperty("fgb-layer","fill-opacity",.9)},300))},R=()=>{t.setPaintProperty("fgb-layer","fill-opacity",0),setTimeout(()=>{t.setFilter("fgb-layer",null),t.setPaintProperty("fgb-layer","fill-opacity",.9)},100)};let t;const G=()=>{t=new h.Map({accessToken:p.mapboxToken,container:"zoning-map",style:"mapbox://styles/mapbox/light-v11",center:p.initialCenter,zoom:p.initialZoom});const l=document.getElementById("zoning-map-loading"),o=document.getElementById("zoning-map-progress"),e=document.getElementById("zoning-map-legend");let n=0,i=null;const _=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3","#7fc97f","#beaed4","#fdc086"],f=new Map;let F=0;function O(a){return f.has(a)||(f.set(a,_[F%_.length]),F++,W()),f.get(a)}function W(){const a=document.createElement("div");for(Array.from(f.entries()).sort((k,v)=>k[0].localeCompare(v[0])).forEach(([k,v])=>{const b=document.createElement("div");b.className="legend-item",b.innerHTML=`<div class="color-block" style="background-color: ${v}"></div>${k}`,a.appendChild(b)});e.childNodes.length>2;)e.removeChild(e.lastChild);e.appendChild(a)}function X(a){n=a,o.textContent=`Loaded ${a} features`}t.on("load",async()=>{try{l.style.display="block",o.style.display="block",console.log("Starting to load FlatGeoBuf data..."),t.addSource("fgb-data",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"fgb-layer",type:"fill",source:"fgb-data",paint:{"fill-color":"#ccc","fill-opacity":.7,"fill-outline-color":"#000"}}),i=t.getSource("fgb-data");let a=[];const v=await fetch("https://verso-uvm.github.io/Vermont-Livability-Map/data/vt-zoning-spatial-index.fgb");if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);const b=new Set;for await(const y of le(v.body)){const N=y.properties.Type_of_Zoning_District||"Unknown";O(N);const j=y.properties.Jurisdiction||"Unknown";if(b.add(j),a.push(y),n++,n%100===0&&(X(n),i.setData({type:"FeatureCollection",features:a}),f.size>0)){const M=["match",["get","Type_of_Zoning_District"]];for(const[Y,Q]of f)M.push(Y),M.push(Q);M.push("#ccc"),t.setPaintProperty("fgb-layer","fill-color",M)}}P.value=Array.from(b).sort(),T.value=P.value,i.setData({type:"FeatureCollection",features:a}),d.value=a,console.log(a);const C=new h.LngLatBounds;a.forEach(y=>{if(y.geometry){const N=y.geometry.coordinates;y.geometry.type==="Polygon"?N[0].forEach(j=>C.extend(j)):y.geometry.type==="Point"&&C.extend(N)}}),t.fitBounds(C,{padding:50}),console.log("Map visualization complete"),console.log("Zoning types and colors:",Array.from(f.entries()))}catch(a){console.error("Error loading FlatGeoBuf data:",a),l.textContent="Error loading data"}finally{l.style.display="none",o.style.display="none"}}),t.on("click","fgb-layer",a=>{if(!a.features.length)return;const k=a.features[0],v=a.lngLat,b=Object.entries(k.properties).map(([C,y])=>`<strong>${C}:</strong> ${y}`).join("<br>");new h.Popup().setLngLat(v).setHTML(b).addTo(t)}),t.on("mouseenter","fgb-layer",()=>{t.getCanvas().style.cursor="pointer"}),t.on("mouseleave","fgb-layer",()=>{t.getCanvas().style.cursor=""}),t.addControl(new h.NavigationControl)};return A(()=>{G()}),ee(()=>{t.value&&t.value.remove()}),(l,o)=>(c(),r("div",null,[s("div",ce,[o[2]||(o[2]=s("div",{class:"disclaimer"},[s("span",{class:"exclamation-icon"},"!"),te(" This map is in Beta, and may contain inaccuracies. ")],-1)),s("div",de,[o[1]||(o[1]=s("label",{style:{"margin-right":"10px"},for:"jurisdiction-search"},"Search for a Town:",-1)),oe(s("input",{id:"jurisdiction-search",type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>u.value=e),onInput:q,placeholder:"Type to search..."},null,544),[[ne,u.value]]),T.value.length?(c(),r("ul",ue,[(c(!0),r(L,null,B(T.value,e=>(c(),r("li",{key:e,onClick:n=>U(e)},E(e),9,ge))),128))])):J("",!0),s("button",{onClick:I,class:"search-button"},"Search")]),o[3]||(o[3]=s("div",{id:"zoning-map"},null,-1)),o[4]||(o[4]=s("div",{id:"zoning-map-loading",class:"loading"},"Loading data...",-1)),o[5]||(o[5]=s("div",{id:"zoning-map-progress"},null,-1)),o[6]||(o[6]=s("div",{id:"zoning-map-legend",class:"legend"},[s("h4",null,"Primary zoning classification")],-1))]),z.value.length?(c(),r("div",pe,[o[7]||(o[7]=s("h3",{style:{"text-align":"center","font-weight":"600"}},"% of districts per zoning type",-1)),(c(!0),r(L,null,B(z.value,(e,n)=>(c(),r("div",{key:n},[V(re,{title:e.type,percentage:e.percentage},null,8,["title","percentage"])]))),128))])):J("",!0),w.value.length?(c(),r("div",fe,[o[8]||(o[8]=s("h4",null,"Town Summary",-1)),s("table",null,[s("thead",null,[s("tr",null,[(c(!0),r(L,null,B(S.value,e=>(c(),r("th",{key:e},E(e),1))),128))])]),s("tbody",null,[(c(!0),r(L,null,B($.value,(e,n)=>(c(),r("tr",{key:n},[(c(!0),r(L,null,B(S.value,i=>(c(),r("td",{key:i},E(e[i]),1))),128))]))),128))])])])):J("",!0)]))}},me={class:"about"},ve={class:"about-container"},he={__name:"RegionalView",setup(m){return(p,d)=>(c(),r("div",me,[s("div",ve,[d[0]||(d[0]=s("h1",{class:"title",style:{"margin-top":"50px"}},"Select a Town",-1)),d[1]||(d[1]=s("p",null," This interactive interface allows you to explore the zoning regulations of different towns in the region. Type in a town and click Search to view its zoning regulations. ",-1)),V(ye,{mapboxToken:"pk.eyJ1IjoiYmRjb29sZXkiLCJhIjoiY20zM2Nzd212MWl3cTJrcTM5NWNrcjk0byJ9.40rHMMd1TXsvF8zeqxLaBw"})])]))}};export{he as default};
