import{r as u,b as U,c as r,o as c,d as a,t as L,n as K,w as Z,e as ee,f as M,g as te,h as oe,v as ne,F as T,i as C,j as q,m as h,k as ae}from"./index-AOOg7IUX.js";const se={class:"bar-chart-container"},ie={class:"bar-wrapper"},le={class:"percentage-label"},re={__name:"ProgressBar",props:{percentage:{type:Number,required:!0,validator:g=>g>=0&&g<=100},title:{type:String,required:!0}},setup(g){const v=g,f=u(0);return U(()=>{setTimeout(()=>{f.value=v.percentage},100)}),(B,d)=>(c(),r("div",se,[a("h3",null,L(g.title),1),a("div",ie,[a("div",{class:"bar",style:K({width:g.percentage+"%"})},[a("span",le,L(g.percentage)+"%",1)],4)])]))}},ce={class:"map-container"},de={class:"controls"},ue={key:0,class:"suggestions"},ge=["onClick"],pe={key:0,class:"zoning-type-breakdown"},fe={key:1,class:"data-summary"},ye={__name:"RegionalMapHighlight",props:{mapboxToken:{type:String,required:!0},initialCenter:{type:Array,default:()=>[-72.5778,44.4688]},initialZoom:{type:Number,default:6},layerToHighlight:{type:String,default:"Nonresidential",requred:!1}},setup(g){const v=g,f=u([]);u(!1);const B=u([]);u("");const d=u(""),w=u([]),_=u([]),N=u(["Full_District_Name","Affordable_Housing_District","Type_of_Zoning_District"]),$=u([]),S=u(0),z=u([]);Z(_,n=>{if(!n.length){z.value=[];return}const o=n.length,e={};n.forEach(i=>{const l=i.properties.Type_of_Zoning_District||"Unknown";e[l]=(e[l]||0)+1}),z.value=Object.entries(e).map(([i,l])=>({type:i,percentage:(l/o*100).toFixed(2)}))});let E=null;const A=()=>{const n=d.value.toLowerCase();w.value=B.value.filter(o=>o.toLowerCase().includes(n))},V=n=>{d.value=n,w.value=[]},I=()=>{if(!t){console.error("Map instance is not initialized.");return}if(d.value){console.log(`Applying filter for jurisdiction: ${d.value}`),t.setFilter("fgb-layer",["==",["get","Jurisdiction"],d.value]),_.value=f.value.filter(e=>e.properties.Jurisdiction===d.value),$.value=_.value.map(e=>{const i={};return N.value.forEach(l=>{i[l]=e.properties[l]||"N/A"}),i}),S.value=new Set(_.value.map(e=>e.properties.Jurisdiction)).size;const n=new h.LngLatBounds;let o=0;if(f.value.forEach(e=>{if(e.properties.Jurisdiction===d.value&&e.geometry){o++;const i=e.geometry.coordinates;e.geometry.type==="Polygon"?i[0].forEach(l=>n.extend(l)):e.geometry.type==="Point"&&n.extend(i)}}),o===0?console.warn(`No features found for jurisdiction: ${d.value}`):console.log(`Found ${o} features for jurisdiction: ${d.value}`),!n.isEmpty())console.log("Fitting map to bounds:",n),t.fitBounds(n,{padding:50}),E=n;else if(console.warn("Bounds are empty. Unable to fit map."),f.value.length>0){console.log("Using default bounds as fallback.");const e=new h.LngLatBounds([-73.5,42.5],[-71.5,45]);t.fitBounds(e,{padding:50})}else if(E)console.log("Using last valid bounds as fallback:",E),t.fitBounds(E,{padding:50});else{console.warn("No fallback bounds available. Using default bounds.");const e=new h.LngLatBounds([-73.5,42.5],[-71.5,45]);t.fitBounds(e,{padding:50})}}else console.log("No jurisdiction selected. Resetting filter."),t.setFilter("fgb-layer",null),_.value=[],$.value=[],S.value=0};Z(v,n=>{console.log("props changed",n.layerToHighlight),n.layerToHighlight==2?J("Primarily Residential"):n.layerToHighlight==3?J("Nonresidential"):R()},{deep:!1});const J=n=>{console.log("toggle",t),t&&(t.setPaintProperty("fgb-layer","fill-opacity",0),setTimeout(()=>{t.setFilter("fgb-layer",["==",["get","Type_of_Zoning_District"],n]),t.setPaintProperty("fgb-layer","fill-opacity",.9)},300))},R=()=>{t.setPaintProperty("fgb-layer","fill-opacity",0),setTimeout(()=>{t.setFilter("fgb-layer",null),t.setPaintProperty("fgb-layer","fill-opacity",.9)},100)};let t;const G=()=>{t=new h.Map({accessToken:v.mapboxToken,container:"zoning-map",style:"mapbox://styles/mapbox/light-v11",center:v.initialCenter,zoom:v.initialZoom});const n=document.getElementById("zoning-map-loading"),o=document.getElementById("zoning-map-progress"),e=document.getElementById("zoning-map-legend");let i=0,l=null;const D=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3","#7fc97f","#beaed4","#fdc086"],b=new Map;let H=0;function O(s){return b.has(s)||(b.set(s,D[H%D.length]),H++,W()),b.get(s)}function W(){const s=document.createElement("div");for(Array.from(b.entries()).sort((k,y)=>k[0].localeCompare(y[0])).forEach(([k,y])=>{const m=document.createElement("div");m.className="legend-item",m.innerHTML=`<div class="color-block" style="background-color: ${y}"></div>${k}`,s.appendChild(m)});e.childNodes.length>2;)e.removeChild(e.lastChild);e.appendChild(s)}function X(s){i=s,o.textContent=`Loaded ${s} features`}t.on("load",async()=>{try{n.style.display="block",o.style.display="block",console.log("Starting to load FlatGeoBuf data..."),t.addSource("fgb-data",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),t.addLayer({id:"fgb-layer",type:"fill",source:"fgb-data",paint:{"fill-color":"#ccc","fill-opacity":.7,"fill-outline-color":"#000"}}),l=t.getSource("fgb-data");let s=[];const y=await fetch("https://verso-uvm.github.io/Vermont-Livability-Map/data/vt-zoning-spatial-index.fgb");if(!y.ok)throw new Error(`HTTP error! status: ${y.status}`);const m=new Set;for await(const p of ae(y.body)){const F=p.properties.Type_of_Zoning_District||"Unknown";O(F);const j=p.properties.Jurisdiction||"Unknown";if(m.add(j),s.push(p),i++,i%100===0&&(X(i),l.setData({type:"FeatureCollection",features:s}),b.size>0)){const P=["match",["get","Type_of_Zoning_District"]];for(const[Y,Q]of b)P.push(Y),P.push(Q);P.push("#ccc"),t.setPaintProperty("fgb-layer","fill-color",P)}}B.value=Array.from(m).sort(),w.value=B.value,l.setData({type:"FeatureCollection",features:s}),f.value=s,console.log(s);const x=new h.LngLatBounds;s.forEach(p=>{if(p.geometry){const F=p.geometry.coordinates;p.geometry.type==="Polygon"?F[0].forEach(j=>x.extend(j)):p.geometry.type==="Point"&&x.extend(F)}}),t.fitBounds(x,{padding:50}),console.log("Map visualization complete"),console.log("Zoning types and colors:",Array.from(b.entries()))}catch(s){console.error("Error loading FlatGeoBuf data:",s),n.textContent="Error loading data"}finally{n.style.display="none",o.style.display="none"}}),t.on("click","fgb-layer",s=>{if(!s.features.length)return;const k=s.features[0],y=s.lngLat,m=Object.entries(k.properties).map(([x,p])=>`<strong>${x}:</strong> ${p}`).join("<br>");new h.Popup().setLngLat(y).setHTML(m).addTo(t)}),t.on("mouseenter","fgb-layer",()=>{t.getCanvas().style.cursor="pointer"}),t.on("mouseleave","fgb-layer",()=>{t.getCanvas().style.cursor=""}),t.addControl(new h.NavigationControl)};return U(()=>{G()}),ee(()=>{t.value&&t.value.remove()}),(n,o)=>(c(),r("div",null,[a("div",ce,[o[2]||(o[2]=a("div",{class:"disclaimer"},[a("span",{class:"exclamation-icon"},"!"),te(" This map is in Beta, and may contain inaccuracies. ")],-1)),a("div",de,[o[1]||(o[1]=a("label",{style:{"margin-right":"10px"},for:"jurisdiction-search"},"Search Jurisdiction:",-1)),oe(a("input",{id:"jurisdiction-search",type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>d.value=e),onInput:A,placeholder:"Type to search..."},null,544),[[ne,d.value]]),w.value.length?(c(),r("ul",ue,[(c(!0),r(T,null,C(w.value,e=>(c(),r("li",{key:e,onClick:i=>V(e)},L(e),9,ge))),128))])):M("",!0),a("button",{onClick:I,class:"search-button"},"Search")]),o[3]||(o[3]=a("div",{id:"zoning-map"},null,-1)),o[4]||(o[4]=a("div",{id:"zoning-map-loading",class:"loading"},"Loading data...",-1)),o[5]||(o[5]=a("div",{id:"zoning-map-progress"},null,-1)),o[6]||(o[6]=a("div",{id:"zoning-map-legend",class:"legend"},[a("h4",null,"Primary zoning classification")],-1))]),z.value.length?(c(),r("div",pe,[o[7]||(o[7]=a("h3",{style:{"text-align":"center","font-weight":"600"}},"% of districts per zoning type",-1)),(c(!0),r(T,null,C(z.value,(e,i)=>(c(),r("div",{key:i},[q(re,{title:e.type,percentage:e.percentage},null,8,["title","percentage"])]))),128))])):M("",!0),_.value.length?(c(),r("div",fe,[o[8]||(o[8]=a("h4",null,"Jurisdiction Summary",-1)),a("table",null,[a("thead",null,[a("tr",null,[(c(!0),r(T,null,C(N.value,e=>(c(),r("th",{key:e},L(e),1))),128))])]),a("tbody",null,[(c(!0),r(T,null,C($.value,(e,i)=>(c(),r("tr",{key:i},[(c(!0),r(T,null,C(N.value,l=>(c(),r("td",{key:l},L(e[l]),1))),128))]))),128))])])])):M("",!0)]))}},me={class:"about"},ve={class:"about-container"},he={__name:"RegionalView",setup(g){return(v,f)=>(c(),r("div",me,[a("div",ve,[f[0]||(f[0]=a("h1",{class:"title",style:{"margin-top":"50px"}},"Select a region",-1)),q(ye,{mapboxToken:"pk.eyJ1IjoiYmRjb29sZXkiLCJhIjoiY20zM2Nzd212MWl3cTJrcTM5NWNrcjk0byJ9.40rHMMd1TXsvF8zeqxLaBw"})])]))}};export{he as default};
