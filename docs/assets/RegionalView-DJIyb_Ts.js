import{r as g,b as V,c as r,o as c,d as l,t as B,n as K,w as H,e as ee,f as J,g as te,h as oe,v as ne,F,i as L,j as q,m as h,k as le}from"./index-DHp4SDjX.js";const ae={class:"bar-chart-container"},se={class:"bar-wrapper"},ie={class:"percentage-label"},re={__name:"ProgressBar",props:{percentage:{type:String,required:!0,validator:m=>{const p=Number(m);return!isNaN(p)&&p>=0&&p<=100}},title:{type:String,required:!0}},setup(m){const p=m,d=g(0);return V(()=>{setTimeout(()=>{d.value=p.percentage},100)}),(z,u)=>(c(),r("div",ae,[l("h3",null,B(m.title),1),l("div",se,[l("div",{class:"bar",style:K({width:m.percentage+"%"})},[l("span",ie,B(m.percentage)+"%",1)],4)])]))}},ce={class:"map-container"},de={class:"controls"},ue={key:0,class:"suggestions"},ge=["onClick"],pe={key:0,class:"zoning-type-breakdown"},ye={key:1,class:"data-summary"},fe={__name:"RegionalMapHighlight",props:{mapboxToken:{type:String,required:!0},initialCenter:{type:Array,default:()=>[-72.5778,44.4688]},initialZoom:{type:Number,default:6},layerToHighlight:{type:String,default:"Nonresidential",requred:!1}},setup(m){const p=m,d=g([]);g(!1);const z=g([]);g("");const u=g(""),k=g([]),w=g([]),$=g(["Full_District_Name","Type_of_Zoning_District","F1_Family_Treatment","F2_Family_Treatment","F3_Family_Treatment","F4_Family_Treatment"]),S=g([]),D=g(0),E=g([]);H(w,a=>{if(!a.length){E.value=[];return}const t=a.length,e={};a.forEach(n=>{const i=n.properties.Type_of_Zoning_District||"Unknown";e[i]=(e[i]||0)+1}),E.value=Object.entries(e).map(([n,i])=>({type:n,percentage:(i/t*100).toFixed(2)}))});let _=null;const A=()=>{const a=u.value.toLowerCase();k.value=z.value.filter(t=>t.toLowerCase().includes(a))},U=a=>{u.value=a,k.value=[]},I=()=>{if(!o){console.error("Map instance is not initialized.");return}if(u.value){console.log(`Applying filter for jurisdiction: ${u.value}`),o.setFilter("fgb-layer",["==",["get","Jurisdiction"],u.value]),w.value=d.value.filter(e=>e.properties.Jurisdiction===u.value),S.value=w.value.map(e=>{const n={};return $.value.forEach(i=>{n[i]=e.properties[i]||"N/A"}),n}),D.value=new Set(w.value.map(e=>e.properties.Jurisdiction)).size;const a=new h.LngLatBounds;let t=0;if(d.value.forEach(e=>{if(e.properties.Jurisdiction.toLowerCase()===u.value.toLowerCase()&&e.geometry){t++;const n=e.geometry.coordinates;e.geometry.type==="Polygon"||e.geometry.type==="MultiPolygon"?(e.geometry.type==="Polygon"?[n]:n).forEach(x=>{x[0].forEach(y=>a.extend(y))}):e.geometry.type==="Point"&&a.extend(n)}}),t===0?console.warn(`No features found for jurisdiction: ${u.value}`):console.log(`Found ${t} features for jurisdiction: ${u.value}`),!a.isEmpty())console.log("Fitting map to bounds:",a),o.fitBounds(a,{padding:50}),_=a;else if(console.warn("Bounds are empty. Attempting to use fallback bounds."),_)console.log("Using last valid bounds as fallback:",_),o.fitBounds(_,{padding:50});else if(d.value.length>0){console.log("Calculating fallback bounds from all features.");const e=new h.LngLatBounds;if(d.value.forEach(n=>{if(n.geometry){const i=n.geometry.coordinates;n.geometry.type==="Polygon"||n.geometry.type==="MultiPolygon"?(n.geometry.type==="Polygon"?[i]:i).forEach(y=>{y[0].forEach(P=>e.extend(P))}):n.geometry.type==="Point"&&e.extend(i)}}),!e.isEmpty())o.fitBounds(e,{padding:50}),_=e;else{console.warn("Fallback bounds are also empty. Using default bounds.");const n=new h.LngLatBounds([-73.5,42.5],[-71.5,45]);o.fitBounds(n,{padding:50})}}else{console.warn("No fallback bounds available. Using default bounds.");const e=new h.LngLatBounds([-73.5,42.5],[-71.5,45]);o.fitBounds(e,{padding:50})}}else console.log("No jurisdiction selected. Resetting filter."),o.setFilter("fgb-layer",null),w.value=[],S.value=[],D.value=0};H(p,a=>{console.log("props changed",a.layerToHighlight),a.layerToHighlight==2?Z("Primarily Residential"):a.layerToHighlight==3?Z("Nonresidential"):R()},{deep:!1});const Z=a=>{console.log("toggle",o),o&&(o.setPaintProperty("fgb-layer","fill-opacity",0),setTimeout(()=>{o.setFilter("fgb-layer",["==",["get","Type_of_Zoning_District"],a]),o.setPaintProperty("fgb-layer","fill-opacity",.9)},300))},R=()=>{o.setPaintProperty("fgb-layer","fill-opacity",0),setTimeout(()=>{o.setFilter("fgb-layer",null),o.setPaintProperty("fgb-layer","fill-opacity",.9)},100)};let o;const G=()=>{o=new h.Map({accessToken:p.mapboxToken,container:"zoning-map",style:"mapbox://styles/mapbox/light-v11",center:p.initialCenter,zoom:p.initialZoom});const a=document.getElementById("zoning-map-loading"),t=document.getElementById("zoning-map-progress"),e=document.getElementById("zoning-map-legend");let n=0,i=null;const x=["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999","#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3","#7fc97f","#beaed4","#fdc086"],y=new Map;let P=0;function O(s){return y.has(s)||(y.set(s,x[P%x.length]),P++,W()),y.get(s)}function W(){const s=document.createElement("div");for(Array.from(y.entries()).sort((T,v)=>T[0].localeCompare(v[0])).forEach(([T,v])=>{const b=document.createElement("div");b.className="legend-item",b.innerHTML=`<div class="color-block" style="background-color: ${v}"></div>${T}`,s.appendChild(b)});e.childNodes.length>2;)e.removeChild(e.lastChild);e.appendChild(s)}function X(s){n=s,t.textContent=`Loaded ${s} features`}o.on("load",async()=>{try{a.style.display="block",t.style.display="block",console.log("Starting to load FlatGeoBuf data..."),o.addSource("fgb-data",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),o.addLayer({id:"fgb-layer",type:"fill",source:"fgb-data",paint:{"fill-color":"#ccc","fill-opacity":.7,"fill-outline-color":"#000"}}),i=o.getSource("fgb-data");let s=[];const v=await fetch("https://verso-uvm.github.io/Vermont-Livability-Map/data/vt-zoning-spatial-index.fgb");if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);const b=new Set;for await(const f of le(v.body)){const N=f.properties.Type_of_Zoning_District||"Unknown";O(N);const j=f.properties.Jurisdiction||"Unknown";if(b.add(j),s.push(f),n++,n%100===0&&(X(n),i.setData({type:"FeatureCollection",features:s}),y.size>0)){const M=["match",["get","Type_of_Zoning_District"]];for(const[Y,Q]of y)M.push(Y),M.push(Q);M.push("#ccc"),o.setPaintProperty("fgb-layer","fill-color",M)}}z.value=Array.from(b).sort(),k.value=z.value,i.setData({type:"FeatureCollection",features:s}),d.value=s,console.log(s);const C=new h.LngLatBounds;s.forEach(f=>{if(f.geometry){const N=f.geometry.coordinates;f.geometry.type==="Polygon"?N[0].forEach(j=>C.extend(j)):f.geometry.type==="Point"&&C.extend(N)}}),o.fitBounds(C,{padding:50}),console.log("Map visualization complete"),console.log("Zoning types and colors:",Array.from(y.entries()))}catch(s){console.error("Error loading FlatGeoBuf data:",s),a.textContent="Error loading data"}finally{a.style.display="none",t.style.display="none"}}),o.on("click","fgb-layer",s=>{if(!s.features.length)return;const T=s.features[0],v=s.lngLat,b=Object.entries(T.properties).map(([C,f])=>`<strong>${C}:</strong> ${f}`).join("<br>");new h.Popup().setLngLat(v).setHTML(b).addTo(o)}),o.on("mouseenter","fgb-layer",()=>{o.getCanvas().style.cursor="pointer"}),o.on("mouseleave","fgb-layer",()=>{o.getCanvas().style.cursor=""}),o.addControl(new h.NavigationControl)};return V(()=>{G()}),ee(()=>{o.value&&o.value.remove()}),(a,t)=>(c(),r("div",null,[l("div",ce,[t[2]||(t[2]=l("div",{class:"disclaimer"},[l("span",{class:"exclamation-icon"},"!"),te(" This map is in Beta, and may contain inaccuracies. ")],-1)),l("div",de,[t[1]||(t[1]=l("label",{style:{"margin-right":"10px"},for:"jurisdiction-search"},"Search for a Town:",-1)),oe(l("input",{id:"jurisdiction-search",type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>u.value=e),onInput:A,placeholder:"Type to search..."},null,544),[[ne,u.value]]),k.value.length?(c(),r("ul",ue,[(c(!0),r(F,null,L(k.value,e=>(c(),r("li",{key:e,onClick:n=>U(e)},B(e),9,ge))),128))])):J("",!0),l("button",{onClick:I,class:"search-button"},"Search")]),t[3]||(t[3]=l("div",{id:"zoning-map"},null,-1)),t[4]||(t[4]=l("div",{id:"zoning-map-loading",class:"loading"},"Loading data...",-1)),t[5]||(t[5]=l("div",{id:"zoning-map-progress"},null,-1)),t[6]||(t[6]=l("div",{id:"zoning-map-legend",class:"legend"},[l("h4",null,"Primary zoning classification")],-1))]),E.value.length?(c(),r("div",pe,[t[7]||(t[7]=l("h3",{style:{"text-align":"center","font-weight":"600"}},"% of districts per zoning type",-1)),(c(!0),r(F,null,L(E.value,(e,n)=>(c(),r("div",{key:n},[q(re,{title:e.type,percentage:e.percentage},null,8,["title","percentage"])]))),128))])):J("",!0),w.value.length?(c(),r("div",ye,[t[8]||(t[8]=l("br",null,null,-1)),t[9]||(t[9]=l("h3",{style:{"text-align":"center","font-weight":"600","font-size":"2rem"}},"District Table",-1)),t[10]||(t[10]=l("br",null,null,-1)),l("table",null,[l("thead",null,[l("tr",null,[(c(!0),r(F,null,L($.value,e=>(c(),r("th",{key:e},B(e),1))),128))])]),l("tbody",null,[(c(!0),r(F,null,L(S.value,(e,n)=>(c(),r("tr",{key:n},[(c(!0),r(F,null,L($.value,i=>(c(),r("td",{key:i},B(e[i]),1))),128))]))),128))])])])):J("",!0)]))}},me={class:"about"},ve={class:"about-container"},he={__name:"RegionalView",setup(m){return(p,d)=>(c(),r("div",me,[l("div",ve,[d[0]||(d[0]=l("h1",{class:"title",style:{"margin-top":"50px"}},"Select a Town",-1)),d[1]||(d[1]=l("p",null," This interactive interface allows you to explore the zoning regulations of different towns in the region. Type in a town and click Search to view its zoning regulations. ",-1)),q(fe,{mapboxToken:"pk.eyJ1IjoiYmRjb29sZXkiLCJhIjoiY20zM2Nzd212MWl3cTJrcTM5NWNrcjk0byJ9.40rHMMd1TXsvF8zeqxLaBw"})])]))}};export{he as default};
